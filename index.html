<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<title>ZEROX GOD MODE - THE RETURN</title>
<style>
    body { margin:0; background:#000; overflow:hidden; font-family:Arial; color:#00f2ff; }
    #hud { position:fixed; top:20px; left:20px; z-index:10; font-size:12px; }
    #status { display: none; }
    #start { position:fixed; bottom:30px; left:50%; transform:translateX(-50%); padding:20px 40px; background:#00f2ff; border:none; font-weight:bold; cursor:pointer; z-index:999; border-radius: 5px; }
</style>
</head>
<body>

<div id="hud"> ZEROX GOD MODE <div id="status">AGUARDANDO...</div> </div>
<button id="start">ATIVAR SISTEMA ZEROX</button>

<video id="webcam" autoplay playsinline style="display:none"></video>
<div id="player"></div>

<script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.min.js"></script>
<script src="https://www.youtube.com/iframe_api"></script>

<script>
const YOUTUBE_API_KEY = "AIzaSyCiYqB5IZRGMPxaBXLGqehItGwr7oG81Tw";
let player, recognition, hands;
let targetExplosion = 1, explosionFactor = 1;

// 1. VOZ (SINTETIZADOR)
function falar(t) {
    window.speechSynthesis.cancel();
    const u = new SpeechSynthesisUtterance(t);
    u.lang = "pt-BR";
    window.speechSynthesis.speak(u);
}

// 2. YOUTUBE API
function onYouTubeIframeAPIReady() {
    player = new YT.Player('player', {
        height: '0', width: '0',
        events: { onReady: () => console.log("Motor de áudio pronto") }
    });
}

// 3. BUSCA SEM O ERRO DO NOME
async function tocar(falaCompleta) {
    // Pega só o que vem depois de "toca"
    let partes = falaCompleta.toLowerCase().split("toca");
    let busca = partes.length > 1 ? partes[1].trim() : falaCompleta;
    
    // Remove qualquer lixo de "zerox" que sobrar
    busca = busca.replace(/zerox|zero x|xis/gi, "").trim();

    if (!busca) return;
    
    falar("Buscando " + busca);
    
    try {
        const res = await fetch(`https://www.googleapis.com/youtube/v3/search?part=id&q=${encodeURIComponent(busca)}&type=video&maxResults=1&key=${YOUTUBE_API_KEY}`);
        const data = await res.json();

        if (data.items && data.items[0]) {
            player.loadVideoById(data.items[0].id.videoId);
            setTimeout(() => { 
                player.unMute(); 
                player.setVolume(100); 
                player.playVideo(); 
            }, 1000);
            falar("Tocando agora.");
        }
    } catch(e) { falar("Erro na conexão."); }
}

// 4. CÉREBRO DA IA
function responder(fala) {
    console.log("Comando recebido:", fala);
    
    if (fala.includes("zerox") || fala.includes("zero x") || fala.includes("xis")) {
        if(player) player.setVolume(20); // Dica de ouro: abaixa o som

        if (fala.includes("toca")) {
            tocar(fala);
        } else if (fala.includes("desligar") || fala.includes("parar") || fala.includes("pausa")) {
            player.pauseVideo();
            falar("Sistema em pausa.");
        } else if (fala.includes("ligar") || fala.includes("voltar") || fala.includes("play")) {
            player.playVideo();
            falar("Sim?");
            setTimeout(() => player.setVolume(100), 2000);
        } else {
            falar("Estou ouvindo.");
            setTimeout(() => player.setVolume(100), 3000);
        }
    }
}

// 5. O GLOBO 3D (O SEU ORIGINAL)
const scene = new THREE.Scene();
const cam = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
cam.position.z = 5;
const renderer = new THREE.WebGLRenderer({alpha:true, antialias: true});
renderer.setSize(window.innerWidth, window.innerHeight);
document.body.appendChild(renderer.domElement);

const geo = new THREE.SphereGeometry(1.6, 64, 64);
const base = geo.attributes.position.array.slice();
const globe = new THREE.Points(geo, new THREE.PointsMaterial({color:0x00f2ff, size:0.015}));
scene.add(globe);

function animate() {
    requestAnimationFrame(animate);
    explosionFactor += (targetExplosion - explosionFactor) * 0.1;
    const attr = globe.geometry.attributes.position;
    for(let i=0; i<attr.count; i++) {
        let s = explosionFactor + Math.sin(i + Date.now()*0.005) * 0.05;
        attr.setXYZ(i, base[i*3]*s, base[i*3+1]*s, base[i*3+2]*s);
    }
    attr.needsUpdate = true;
    globe.rotation.y += 0.002;
    renderer.render(scene, cam);
}
animate();

// 6. DETECÇÃO DA MÃO (FIXED)
function ligarMao() {
    hands = new Hands({locateFile: (file) => `https://cdn.jsdelivr.net/npm/@mediapipe/hands/${file}`});
    hands.setOptions({maxNumHands: 1, modelComplexity: 1, minDetectionConfidence: 0.5});
    hands.onResults(res => {
        if (res.multiHandLandmarks && res.multiHandLandmarks[0]) {
            const pts = res.multiHandLandmarks[0];
            // Distância entre polegar (4) e dedo médio (12)
            const dist = Math.hypot(pts[4].x - pts[12].x, pts[4].y - pts[12].y);
            targetExplosion = dist > 0.2 ? 3 : 1;
        } else { targetExplosion = 1; }
    });
    new Camera(document.getElementById("webcam"), {
        onFrame: async () => { await hands.send({image: document.getElementById("webcam")}); },
        width: 640, height: 480
    }).start();
}

// INICIALIZAÇÃO
document.getElementById("start").onclick = function() {
    this.style.display = "none";
    falar("Zero Xis ativado.");
    
    // Start Voz
    const sr = window.SpeechRecognition || window.webkitSpeechRecognition;
    recognition = new sr();
    recognition.lang = "pt-BR";
    recognition.continuous = true;
    recognition.onresult = e => responder(e.results[e.results.length-1][0].transcript.toLowerCase());
    recognition.onend = () => recognition.start();
    recognition.start();

    // Start Mão com delay pra não dar gargalo
    setTimeout(ligarMao, 1000);
};
</script>
</body>
</html>
