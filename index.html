<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ZEROX GOD MODE</title>
    <style>
        body { margin:0; background:#000; overflow:hidden; color:#00f2ff; font-family:Arial; }
        #hud { position:fixed; top:20px; left:20px; z-index:10; font-size:12px; }
        #status { margin-top:10px; background:rgba(0,242,255,0.1); padding:10px; border-left:3px solid #00f2ff; min-width: 200px; }
        #start { position:fixed; bottom:30px; left:50%; transform:translateX(-50%); padding:20px 40px; background:#00f2ff; border:none; font-weight:bold; cursor:pointer; z-index: 100; }
    </style>
</head>
<body>

<div id="hud">
    ZEROX GOD MODE V6
    <div id="status">AGUARDANDO ATIVAÇÃO...</div>
</div>

<button id="start">ATIVAR SISTEMA</button>

<video id="webcam" autoplay playsinline style="display:none"></video>
<div id="player"></div>

<script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.min.js"></script>
<script src="https://www.youtube.com/iframe_api"></script>

<script>
// ================= CONFIG =================
const YOUTUBE_API_KEY = "AIzaSyCiYqB5IZRGMPxaBXLGqehItGwr7oG81Tw"; 

let player, recognition;
let synth = window.speechSynthesis;
let musicaTocando = false;
let aguardandoResposta = false;
let aguardandoConfirmacao = false;

// ================= VOZ BRASILEIRA =================
function falar(texto){
    synth.cancel();
    let u = new SpeechSynthesisUtterance(texto);
    u.lang = "pt-BR";
    u.pitch = 0.8; // Tom mais encorpado
    synth.speak(u);
    document.getElementById("status").innerText = texto;
}

// ================= YOUTUBE =================
function onYouTubeIframeAPIReady(){
    player = new YT.Player('player',{
        height:'0', width:'0',
        events:{ onReady: e => e.target.mute() }
    });
}

async function tocar(termo){
    falar("Buscando " + termo);
    try {
        const res = await fetch(`https://www.googleapis.com/youtube/v3/search?part=id&q=${encodeURIComponent(termo)}&type=video&maxResults=1&key=${YOUTUBE_API_KEY}`);
        const data = await res.json();
        if(data.items && data.items[0]){
            const id = data.items[0].id.videoId;
            player.loadVideoById(id);
            setTimeout(() => {
                player.unMute();
                player.setVolume(100);
            }, 1000);
            musicaTocando = true;
            falar("Tocando agora.");
        }
    } catch(e) { falar("Erro ao buscar no YouTube."); }
}

// ================= LÓGICA DE IA =================
function responder(fala){
    console.log("Zerox ouviu:", fala);

    // 1. ATIVAÇÃO: "ZEROX" (Baixa o som e ouve)
    if(fala.includes("zerox") || fala.includes("xerox") || fala.includes("xis")){
        if(musicaTocando) player.setVolume(30); // Baixa o som para 30%
        falar("Sim, estou ouvindo. Em que posso ajudar?");
        aguardandoResposta = true;
        return;
    }

    // 2. COMANDOS APÓS ATIVAÇÃO
    if(aguardandoResposta){
        aguardandoResposta = false;

        if(fala.includes("toca") || fala.includes("tocar")){
            let termo = fala.replace(/toca|tocar/gi, "").trim();
            tocar(termo);
        } else if(fala.includes("hora")){
            falar("Agora são " + new Date().toLocaleTimeString());
            verificarContinuidade();
        } else {
            falar("Entendido.");
            verificarContinuidade();
        }
        return;
    }

    // 3. CONFIRMAÇÃO DE MÚSICA
    if(aguardandoConfirmacao){
        aguardandoConfirmacao = false;
        if(fala.includes("sim") || fala.includes("pode") || fala.includes("continua")){
            if(musicaTocando) player.setVolume(100);
            falar("Retomando volume máximo.");
        } else {
            if(player) player.pauseVideo();
            musicaTocando = false;
            falar("Música interrompida.");
        }
        return;
    }
}

function verificarContinuidade(){
    if(musicaTocando){
        setTimeout(() => {
            falar("Deseja continuar tocando a música?");
            aguardandoConfirmacao = true;
        }, 2000);
    }
}

// ================= ESCUTA =================
function iniciarVoz(){
    const Speech = window.SpeechRecognition || window.webkitSpeechRecognition;
    recognition = new Speech();
    recognition.lang = "pt-BR";
    recognition.continuous = true;
    recognition.onresult = e => {
        const fala = e.results[e.results.length-1][0].transcript.toLowerCase();
        responder(fala);
    };
    recognition.onend = () => recognition.start();
    recognition.start();
}

// ================= 3D E MÃO =================
const scene = new THREE.Scene();
const camera = new THREE.PerspectiveCamera(75, innerWidth/innerHeight, 0.1, 1000);
camera.position.z = 5;
const renderer = new THREE.WebGLRenderer({ alpha:true, antialias: true });
renderer.setSize(innerWidth, innerHeight);
document.body.appendChild(renderer.domElement);

const geo = new THREE.SphereGeometry(1.6, 64, 64);
const base = geo.attributes.position.array.slice();
const globe = new THREE.Points(geo, new THREE.PointsMaterial({color:0x00f2ff, size:0.015}));
scene.add(globe);

// Mão (Efeito de Explosão)
let explosionFactor = 1;
let targetExplosion = 1;

const hands = new Hands({ locateFile: f => `https://cdn.jsdelivr.net/npm/@mediapipe/hands/${f}` });
hands.setOptions({ maxNumHands: 1 });
hands.onResults(res => {
    if(res.multiHandLandmarks && res.multiHandLandmarks[0]){
        const pts = res.multiHandLandmarks[0];
        const dist = Math.hypot(pts[0].x - pts[12].x, pts[0].y - pts[12].y);
        targetExplosion = dist > 0.35 ? 3 : 1; // Abre a mão = Explode o globo
    }
});

function iniciarSensores(){
    new Camera(document.getElementById("webcam"), {
        onFrame: async () => { await hands.send({ image: webcam }); },
        width: 1280, height: 720
    }).start();
}

// ================= ANIMAÇÃO =================
let pulse = 0;
function animate(){
    requestAnimationFrame(animate);
    pulse += 0.05;
    explosionFactor += (targetExplosion - explosionFactor) * 0.08;
    const attr = globe.geometry.attributes.position;
    for(let i=0; i<attr.count; i++){
        const scale = explosionFactor + Math.sin(i + pulse) * 0.05;
        attr.setXYZ(i, base[i*3]*scale, base[i*3+1]*scale, base[i*3+2]*scale);
    }
    attr.needsUpdate = true;
    globe.rotation.y += 0.002;
    renderer.render(scene, camera);
}
animate();

// ================= START =================
document.getElementById("start").onclick = function(){
    this.style.display = 'none';
    falar("Zero Xis online. Sistemas de voz e mão prontos.");
    iniciarVoz();
    iniciarSensores();
    if(player) player.unMute();
};
</script>
</body>
</html>
