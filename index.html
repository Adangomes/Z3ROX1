<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ZEROX</title>

<style>
body {
    margin: 0;
    background: #000;
    overflow: hidden;
    color: #00f2ff;
    font-family: 'Segoe UI', sans-serif;
}

#ui-layer {
    position: fixed;
    top: 20px;
    left: 20px;
    font-size: 11px;
    letter-spacing: 2px;
    z-index: 10;
    font-weight: bold;
}

#status-zero {
    position: fixed;
    top: 50px;
    left: 20px;
    font-size: 14px;
    color: #fff;
    background: rgba(0,242,255,0.1);
    padding: 10px;
    border-left: 4px solid #00f2ff;
    min-width: 280px;
}

#startBtn {
    position: fixed;
    bottom: 30px;
    left: 50%;
    transform: translateX(-50%);
    padding: 20px 40px;
    background: #00f2ff;
    color: #000;
    border: none;
    font-weight: 900;
    cursor: pointer;
}
</style>
</head>

<body>

<div id="ui-layer">ZEROX_V2</div>
<div id="status-zero">AGUARDANDO...</div>
<button id="startBtn">ATIVAR</button>

<video id="webcam" autoplay playsinline style="display:none"></video>
<div id="player"></div>

<script src="https://www.youtube.com/iframe_api"></script>

<script>
const YOUTUBE_API_KEY = "AIzaSyA1YzpPogtFgGavsIdc7fh6X4gvmgYfO9I";

let player;
let recognition;
let synth = window.speechSynthesis;

// ================= VOZ =================
function falar(texto){
    synth.cancel();

    const utter = new SpeechSynthesisUtterance(texto);
    utter.lang = "pt-BR";
    utter.rate = 1;

    synth.speak(utter);
    document.getElementById("status-zero").innerText = "ZEROX: " + texto;
}

// ================= YOUTUBE =================
function onYouTubeIframeAPIReady(){
    player = new YT.Player('player',{
        height:'0',
        width:'0',
        playerVars:{
            autoplay:1,
            controls:0
        },
        events:{
            onReady:(e)=>{
                e.target.mute(); // inicia mudo
            }
        }
    });
}

async function buscarNoYouTube(termo){
    if(!termo) return;

    falar("Buscando " + termo);

    try{
        const res = await fetch(`https://www.googleapis.com/youtube/v3/search?part=id&q=${encodeURIComponent(termo)}&type=video&maxResults=1&key=${YOUTUBE_API_KEY}`);
        const data = await res.json();

        if(data.items && data.items.length > 0){
            const id = data.items[0].id.videoId;

            player.loadVideoById(id);

            setTimeout(()=>{
                player.unMute();
                player.setVolume(100);
                player.playVideo();
            },500);

            falar("Tocando agora");
        } else {
            falar("Não encontrei essa música");
        }

    }catch(e){
        falar("Erro ao buscar música");
    }
}

// ================= VOZ =================
function initVoice(){
    const Speech = window.SpeechRecognition || window.webkitSpeechRecognition;

    recognition = new Speech();
    recognition.lang = "pt-BR";
    recognition.continuous = true;

    recognition.onresult = (event)=>{
        const fala = event.results[event.results.length-1][0].transcript.toLowerCase();

        console.log("Você disse:", fala);

        // ATIVAÇÃO
        if(fala.includes("zerox") || fala.includes("zero x") || fala.includes("xerox")){
            falar("Olá, boa tarde! Em que posso ajudar?");
        }

        // TOCAR MUSICA
        if(fala.includes("toca") || fala.includes("tocar")){
            let termo = fala
                .replace("toca","")
                .replace("tocar","")
                .trim();

            buscarNoYouTube(termo);
        }
    };

    recognition.start();
}

// ================= START =================
function iniciar(){
    document.getElementById("startBtn").style.display = "none";

    // libera audio (importante pro navegador)
    if(player){
        player.unMute();
        player.setVolume(100);
    }

    falar("Sistema iniciado");
    initVoice();
}

document.getElementById("startBtn").onclick = iniciar;

</script>
</body>
</html>
