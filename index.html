<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ZEROX GOD MODE</title>
    <style>
        body { margin: 0; background: #000; overflow: hidden; color: #00f2ff; font-family: 'Segoe UI', Arial, sans-serif; }
        #hud { position: fixed; top: 20px; left: 20px; z-index: 10; font-size: 12px; letter-spacing: 2px; font-weight: bold; }
        #status {
            margin-top: 10px;
            background: rgba(0, 242, 255, 0.1);
            padding: 15px;
            border-left: 4px solid #00f2ff;
            min-width: 250px;
            font-size: 16px;
            text-transform: uppercase;
        }
        #start {
            position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%);
            padding: 20px 50px; background: #00f2ff; border: none;
            font-weight: 900; cursor: pointer; border-radius: 5px; box-shadow: 0 0 20px #00f2ff;
        }
        #webcam { display: none; }
    </style>
</head>
<body>

<div id="hud">
    SNOOP TECH // ZEROX GOD MODE V6
    <div id="status">SISTEMA OFFLINE</div>
</div>

<button id="start">ATIVAR SISTEMA</button>

<video id="webcam" autoplay playsinline></video>
<div id="player"></div>

<script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.min.js"></script>
<script src="https://www.youtube.com/iframe_api"></script>

<script>
// ================= CONFIGURAÇÃO =================
const YOUTUBE_API_KEY = "AIzaSyA1YzpPogtFgGavsIdc7fh6X4gvmgYfO9I"; // Sua chave

let player, recognition;
let synth = window.speechSynthesis;
let explosionFactor = 1.0;
let targetExplosion = 1.0;

// CONTROLES DE ESTADO
let musicaTocando = false;
let aguardandoComando = false;
let aguardandoConfirmacao = false;

// ================= SISTEMA DE VOZ (BRASIL) =================
function falar(texto) {
    synth.cancel();
    const utter = new SpeechSynthesisUtterance(texto);
    const voices = synth.getVoices();
    // Força voz brasileira masculina se disponível
    utter.voice = voices.find(v => v.lang === 'pt-BR' && v.name.includes('Google')) || voices.find(v => v.lang === 'pt-BR');
    utter.pitch = 0.8;
    utter.rate = 1.0;
    synth.speak(utter);
    document.getElementById("status").innerText = "ZEROX: " + texto;
}

// ================= YOUTUBE (MODO OCULTO) =================
function onYouTubeIframeAPIReady() {
    player = new YT.Player('player', {
        height: '0', width: '0',
        events: { 'onReady': (e) => e.target.mute() }
    });
}

async function tocarMusica(termo) {
    falar("Localizando " + termo);
    try {
        const res = await fetch(`https://www.googleapis.com/youtube/v3/search?part=id&q=${encodeURIComponent(termo)}&type=video&maxResults=1&key=${YOUTUBE_API_KEY}`);
        const data = await res.json();
        if (data.items && data.items[0]) {
            const id = data.items[0].id.videoId;
            player.loadVideoById(id);
            setTimeout(() => { player.unMute(); player.setVolume(100); }, 1000);
            musicaTocando = true;
            falar("Tocando agora.");
        }
    } catch (e) { falar("Erro na busca."); }
}

// ================= INTELIGÊNCIA ZEROX =================
function processarFala(fala) {
    console.log("OUVIDO:", fala);

    // 1. ATIVAÇÃO (Ouvir "Zerox" ou "Xis")
    if (!aguardandoComando && !aguardandoConfirmacao && (fala.includes("zerox") || fala.includes("xis") || fala.includes("xerox"))) {
        if (musicaTocando) player.setVolume(20); // BAIXA 80% DO VOLUME PARA OUVIR
        falar("Sim, em que posso te ajudar?");
        aguardandoComando = true;
        return;
    }

    // 2. PROCESSAR COMANDO APÓS ATIVAÇÃO
    if (aguardandoComando) {
        aguardandoComando = false;

        if (fala.includes("tocar") || fala.includes("toca")) {
            let busca = fala.replace(/tocar|toca|música/g, "").trim();
            tocarMusica(busca);
        } else if (fala.includes("hora")) {
            falar("Agora são " + new Date().toLocaleTimeString('pt-BR', {hour: '2-digit', minute:'2-digit'}));
            perguntarContinuar();
        } else {
            falar("Entendido sua solicitação.");
            perguntarContinuar();
        }
        return;
    }

    // 3. CONFIRMAÇÃO (CONTINUAR TOCANDO?)
    if (aguardandoConfirmacao) {
        aguardandoConfirmacao = false;
        if (fala.includes("sim") || fala.includes("pode") || fala.includes("continua")) {
            if (musicaTocando) player.setVolume(100);
            falar("Retomando áudio.");
        } else {
            if (player) player.pauseVideo();
            musicaTocando = false;
            falar("Música pausada. Zerox em prontidão.");
        }
    }
}

function perguntarContinuar() {
    if (musicaTocando) {
        setTimeout(() => {
            falar("Deseja continuar tocando a música?");
            aguardandoConfirmacao = true;
        }, 2500);
    }
}

// ================= RECONHECIMENTO DE VOZ =================
function iniciarEscuta() {
    const Speech = window.SpeechRecognition || window.webkitSpeechRecognition;
    recognition = new Speech();
    recognition.lang = "pt-BR";
    recognition.continuous = true;
    recognition.onresult = (e) => {
        const fala = e.results[e.results.length - 1][0].transcript.toLowerCase();
        processarFala(fala);
    };
    recognition.onend = () => recognition.start();
    recognition.start();
}

// ================= CENA 3D (GLOBO E MÃO) =================
const scene = new THREE.Scene();
const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
renderer.setSize(window.innerWidth, window.innerHeight);
document.body.appendChild(renderer.domElement);

const sphereGeo = new THREE.SphereGeometry(1.6, 64, 64);
const basePositions = sphereGeo.attributes.position.array.slice();
const globe = new THREE.Points(sphereGeo, new THREE.PointsMaterial({ color: 0x00f2ff, size: 0.015 }));
scene.add(globe);

camera.position.z = 5;

// MÃO MEDIAPIPE
const hands = new Hands({ locateFile: (f) => `https://cdn.jsdelivr.net/npm/@mediapipe/hands/${f}` });
hands.setOptions({ maxNumHands: 1, modelComplexity: 1, minDetectionConfidence: 0.7 });

hands.onResults(res => {
    if (res.multiHandLandmarks && res.multiHandLandmarks[0]) {
        const pts = res.multiHandLandmarks[0];
        // Distância entre polegar e ponta do dedo médio para explosão
        const dist = Math.hypot(pts[0].x - pts[12].x, pts[0].y - pts[12].y);
        targetExplosion = dist > 0.35 ? 2.5 : 1.0;
    }
});

function iniciarCamera() {
    const cam = new Camera(document.getElementById("webcam"), {
        onFrame: async () => { await hands.send({ image: document.getElementById("webcam") }); },
        width: 1280, height: 720
    });
    cam.start();
}

// ================= LOOP DE ANIMAÇÃO =================
function animate() {
    requestAnimationFrame(animate);
    
    // Suavização da Explosão
    explosionFactor += (targetExplosion - explosionFactor) * 0.1;
    const attr = globe.geometry.attributes.position;
    for (let i = 0; i < attr.count; i++) {
        attr.setXYZ(i, basePositions[i*3] * explosionFactor, basePositions[i*3+1] * explosionFactor, basePositions[i*3+2] * explosionFactor);
    }
    attr.needsUpdate = true;

    globe.rotation.y += 0.002;
    renderer.render(scene, camera);
}
animate();

// ================= BOTÃO START =================
document.getElementById("start").onclick = () => {
    document.getElementById("start").style.display = 'none';
    falar("Sistemas Zerox iniciados. Olá.");
    iniciarEscuta();
    iniciarCamera();
    if (player) player.unMute();
};

window.addEventListener('resize', () => {
    camera.aspect = window.innerWidth / window.innerHeight;
    camera.updateProjectionMatrix();
    renderer.setSize(window.innerWidth, window.innerHeight);
});
</script>
</body>
</html>
