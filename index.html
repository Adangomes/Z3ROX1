<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<title>ZEROX GOD - VERSÃO FINALÍSSIMA</title>
<style>
    body { margin:0; background:#000; overflow:hidden; font-family:Arial; color:#00f2ff; }
    #hud { position:fixed; top:20px; left:20px; z-index:10; font-size:12px; }
    #status { display: none; }
    #start { position:fixed; bottom:30px; left:50%; transform:translateX(-50%); padding:20px 40px; background:#00f2ff; border:none; font-weight:bold; cursor:pointer; z-index:999; }
</style>
</head>
<body>

<div id="hud"> ZEROX GOD MODE <div id="status">AGUARDANDO...</div> </div>
<button id="start">ATIVAR SISTEMA</button>

<video id="webcam" autoplay playsinline style="display:none"></video>
<div id="player"></div>

<script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.min.js"></script>
<script src="https://www.youtube.com/iframe_api"></script>

<script>
const YOUTUBE_API_KEY = "AIzaSyCiYqB5IZRGMPxaBXLGqehItGwr7oG81Tw";
let player, recognition, hands;
let targetExplosion = 1;
let explosionFactor = 1;

function falar(texto){
    window.speechSynthesis.cancel();
    let u = new SpeechSynthesisUtterance(texto);
    u.lang = "pt-BR";
    window.speechSynthesis.speak(u);
}

function onYouTubeIframeAPIReady(){
    player = new YT.Player('player',{
        height:'0', width:'0',
        events:{ onReady: () => console.log("YT Pronto") }
    });
}

async function tocar(termoOriginal){
    // O TRUQUE: Pega tudo que vem DEPOIS da palavra "toca"
    let partes = termoOriginal.toLowerCase().split("toca");
    let busca = partes.length > 1 ? partes[1].trim() : termoOriginal.replace(/zerox|zero x|xis/gi, "").trim();
    
    // Limpeza extra para remover resíduos
    busca = busca.replace(/zerox|zero x|xis/gi, "").trim();

    if(!busca) return;
    
    falar("Buscando " + busca);
    
    try {
        const res = await fetch(`https://www.googleapis.com/youtube/v3/search?part=id&q=${encodeURIComponent(busca)}&type=video&maxResults=1&key=${YOUTUBE_API_KEY}`);
        const data = await res.json();

        if(data.items && data.items[0]){
            const id = data.items[0].id.videoId;
            player.loadVideoById(id);
            
            // Força o som a ligar
            setTimeout(() => { 
                player.unMute(); 
                player.setVolume(100);
                player.playVideo(); 
            }, 1000);
            
            falar("Tocando " + busca);
        } else {
            falar("Não achei essa música.");
        }
    } catch(e) {
        falar("Erro na busca.");
    }
}

function responder(fala){
    console.log("Ouvi:", fala);

    if(fala.includes("zerox") || fala.includes("zero x") || fala.includes("xis")){
        if(player) player.setVolume(15);
        
        if(fala.includes("toca")) {
            tocar(fala);
        } else if(fala.includes("parar") || fala.includes("desligar") || fala.includes("pausa")) {
            player.pauseVideo();
            falar("Pausado.");
        } else if(fala.includes("ligar") || fala.includes("continuar") || fala.includes("voltar")) {
            player.playVideo();
            falar("Sim?");
            setTimeout(() => player.setVolume(100), 2000);
        } else if(fala.includes("hora")) {
            falar("São " + new Date().toLocaleTimeString());
            setTimeout(() => player.setVolume(100), 3000);
        } else {
            falar("Sim, mestre?");
            setTimeout(() => player.setVolume(100), 3000);
        }
    }
}

// CONFIG MÃO (SENSÍVEL)
function configMao(){
    hands = new Hands({locateFile: (file) => `https://cdn.jsdelivr.net/npm/@mediapipe/hands/${file}`});
    hands.setOptions({maxNumHands: 1, modelComplexity: 1, minDetectionConfidence: 0.5});
    hands.onResults(res => {
        if(res.multiHandLandmarks && res.multiHandLandmarks[0]){
            const pts = res.multiHandLandmarks[0];
            // Distância entre punho (0) e dedo médio (12)
            const dist = Math.hypot(pts[0].x - pts[12].x, pts[0].y - pts[12].y);
            targetExplosion = dist > 0.4 ? 3.5 : 1;
        } else {
            targetExplosion = 1;
        }
    });

    const cam = new Camera(document.getElementById("webcam"), {
        onFrame: async () => { await hands.send({image: document.getElementById("webcam")}); },
        width: 640, height: 480
    });
    cam.start();
}

// 3D
const scene = new THREE.Scene();
const cam3d = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
cam3d.position.z = 5;
const renderer = new THREE.WebGLRenderer({alpha:true, antialias: true});
renderer.setSize(window.innerWidth, window.innerHeight);
document.body.appendChild(renderer.domElement);

const geo = new THREE.SphereGeometry(1.6, 64, 64);
const base = geo.attributes.position.array.slice();
const globe = new THREE.Points(geo, new THREE.PointsMaterial({color:0x00f2ff, size:0.015}));
scene.add(globe);

function animate(){
    requestAnimationFrame(animate);
    explosionFactor += (targetExplosion - explosionFactor) * 0.1;
    const attr = globe.geometry.attributes.position;
    for(let i=0; i<attr.count; i++){
        const scale = explosionFactor + Math.sin(i + Date.now()*0.005) * 0.05;
        attr.setXYZ(i, base[i*3]*scale, base[i*3+1]*scale, base[i*3+2]*scale);
    }
    attr.needsUpdate = true;
    globe.rotation.y += 0.002;
    renderer.render(scene, cam3d);
}
animate();

document.getElementById("start").onclick = function(){
    this.style.display = "none";
    falar("Zero Xis online.");
    
    const Speech = window.SpeechRecognition || window.webkitSpeechRecognition;
    recognition = new Speech();
    recognition.lang = "pt-BR";
    recognition.continuous = true;
    recognition.onresult = e => responder(e.results[e.results.length-1][0].transcript.toLowerCase());
    recognition.onend = () => recognition.start();
    recognition.start();

    configMao();
};
</script>
</body>
</html>
