<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<title>ZEROX - TESTE DE SOM</title>
<style>
    body { margin:0; background:#000; display:flex; align-items:center; justify-content:center; height:100vh; color:#00f2ff; font-family:sans-serif; }
    #start { padding:20px 40px; background:#00f2ff; border:none; font-weight:bold; cursor:pointer; font-size:20px; }
    #status { position:fixed; top:20px; width:100%; text-align:center; }
</style>
</head>
<body>

<div id="status">CLIQUE NO BOTÃO PARA INICIAR</div>
<button id="start">LIGAR ZEROX</button>
<div id="player"></div>

<script src="https://www.youtube.com/iframe_api"></script>

<script>
const YOUTUBE_API_KEY = "AIzaSyApmJHahtrbmxS-hsVApE37qmHBVP67Du8";
let player, recognition;

function falar(t) {
    window.speechSynthesis.cancel();
    const u = new SpeechSynthesisUtterance(t);
    u.lang = "pt-BR";
    window.speechSynthesis.speak(u);
    document.getElementById("status").innerText = t;
}

function onYouTubeIframeAPIReady() {
    player = new YT.Player('player', { height: '1', width: '1' });
}

async function tocar(fala) {
    // LIMPEZA TOTAL: Ignora tudo até a palavra "toca"
    let busca = "";
    if(fala.includes("toca")) {
        busca = fala.split("toca")[1].trim();
    } else {
        busca = fala.replace(/zerox|zero x|xis/gi, "").trim();
    }
    
    // Remove qualquer "zero x" que tenha sobrado
    busca = busca.replace(/zerox|zero x|xis/gi, "").trim();

    if (!busca) return;
    
    falar("A procurar " + busca);
    
    const url = `https://www.googleapis.com/youtube/v3/search?part=id&q=${encodeURIComponent(busca)}&type=video&maxResults=1&key=${YOUTUBE_API_KEY}`;
    
    try {
        const res = await fetch(url);
        const data = await res.json();
        if (data.items && data.items[0]) {
            player.loadVideoById(data.items[0].id.videoId);
            setTimeout(() => { 
                player.unMute(); 
                player.setVolume(100); 
                player.playVideo(); 
            }, 1000);
            falar("A tocar agora.");
        }
    } catch(e) { falar("Erro na busca."); }
}

function responder(fala) {
    console.log("Ouvi:", fala);
    if (fala.includes("zerox") || fala.includes("zero x") || fala.includes("xis")) {
        if(player) player.setVolume(20);

        if (fala.includes("toca")) {
            tocar(fala);
        } else if (fala.includes("parar") || fala.includes("desligar")) {
            player.pauseVideo();
            falar("Pausado.");
        } else if (fala.includes("ligar") || fala.includes("continuar")) {
            player.playVideo();
            falar("Ok.");
            setTimeout(() => player.setVolume(100), 2000);
        } else {
            falar("Sim, mestre?");
            setTimeout(() => player.setVolume(100), 3000);
        }
    }
}

document.getElementById("start").onclick = function() {
    this.style.display = "none";
    falar("Zero Xis Online.");
    
    const sr = window.SpeechRecognition || window.webkitSpeechRecognition;
    recognition = new sr();
    recognition.lang = "pt-BR";
    recognition.continuous = true;
    recognition.onresult = e => {
        const fala = e.results[e.results.length-1][0].transcript.toLowerCase();
        responder(fala);
    };
    recognition.onend = () => recognition.start();
    recognition.start();
};
</script>
</body>
</html>
